# Smarticafe Pro 2.0 é‡æ„è®¡åˆ’

## ğŸ“‹ é‡æ„æ¦‚è¿°

**åˆ†æ”¯**: `refactor/api-and-naming`  
**åŸºäº**: `v2.0.0-port-update-20260117-210244`  
**å¼€å§‹æ—¶é—´**: 2026-01-17 21:02  
**é¢„è®¡å®Œæˆ**: 2026-01-20

---

## ğŸ¯ é‡æ„ç›®æ ‡

### é˜¶æ®µä¸€ï¼šAPIå®Œå–„ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
- [ ] æ·»åŠ ç¾å›¢è®¢å•API
- [ ] æ·»åŠ äº¤ç­è®¡ç®—API
- [ ] æ·»åŠ è´¢åŠ¡è®°è´¦API
- [ ] ç»Ÿä¸€APIå“åº”æ ¼å¼
- [ ] æ·»åŠ APIæ–‡æ¡£

### é˜¶æ®µäºŒï¼šå‘½åè§„èŒƒåŒ–ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
- [ ] é‡å‘½åæ‹¼éŸ³å˜é‡ä¸ºè‹±æ–‡
- [ ] ç»Ÿä¸€è·¯ç”±å‘½åé£æ ¼
- [ ] æ·»åŠ TypeScriptç±»å‹å®šä¹‰
- [ ] ç§»é™¤anyç±»å‹

### é˜¶æ®µä¸‰ï¼šå¯¼èˆªæ é‡æ„ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
- [ ] åˆ†ç¦»å†…éƒ¨è·¯ç”±å’Œå¤–éƒ¨é“¾æ¥
- [ ] ä¼˜åŒ–å¯¼èˆªæ UI/UX
- [ ] æ·»åŠ å¤–éƒ¨å·¥å…·åŒºåŸŸ

### é˜¶æ®µå››ï¼šä»£ç ä¼˜åŒ–ï¼ˆä½ä¼˜å…ˆçº§ï¼‰
- [ ] æ‹†åˆ†CashierView.vue
- [ ] æ¨¡å—åŒ–ç»„ä»¶
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•

---

## ğŸ“ æ–‡ä»¶ç»“æ„è§„åˆ’

### æ–°å¢APIæ–‡ä»¶
```
src/api/
  â”œâ”€â”€ products.ts          (å·²å­˜åœ¨)
  â”œâ”€â”€ meituan.ts          (æ–°å¢)
  â”œâ”€â”€ shift.ts            (æ–°å¢)
  â”œâ”€â”€ finance.ts          (æ–°å¢)
  â””â”€â”€ types.ts            (æ–°å¢ - ç»Ÿä¸€ç±»å‹å®šä¹‰)
```

### åç«¯APIè·¯ç”±
```
src-tauri/src/
  â”œâ”€â”€ http_server.rs      (æ‰©å±•)
  â””â”€â”€ api/                (æ–°å¢æ¨¡å—)
      â”œâ”€â”€ mod.rs
      â”œâ”€â”€ products.rs
      â”œâ”€â”€ meituan.rs
      â”œâ”€â”€ shift.rs
      â””â”€â”€ finance.rs
```

### ç»„ä»¶æ‹†åˆ†
```
src/views/cashier/
  â”œâ”€â”€ CashierView.vue           (ä¸»è§†å›¾ - ç®€åŒ–)
  â”œâ”€â”€ HandoverModule.vue        (äº¤ç­æ¨¡å—)
  â”œâ”€â”€ FinanceModule.vue         (è´¢åŠ¡æ¨¡å—)
  â”œâ”€â”€ MeituanModule.vue         (ç¾å›¢æ¨¡å—)
  â””â”€â”€ components/
      â”œâ”€â”€ HandoverTable.vue
      â”œâ”€â”€ FinanceTable.vue
      â””â”€â”€ MeituanTable.vue
```

---

## ğŸ”„ å˜é‡é‡å‘½åæ˜ å°„è¡¨

### ShiftState é‡å‘½å
| æ—§åç§° (æ‹¼éŸ³) | æ–°åç§° (è‹±æ–‡) | è¯´æ˜ |
|--------------|--------------|------|
| `wangfei` | `internetFee` | ç½‘è´¹ |
| `shouhuo` | `salesRevenue` | å”®è´§æ”¶å…¥ |
| `meituan` | `meituanRevenue` | ç¾å›¢æ”¶å…¥ |
| `zhichu` | `expenditure` | æ”¯å‡º |
| `yingjiao` | `amountDue` | åº”äº¤é‡‘é¢ |

### å…¶ä»–å˜é‡
| æ—§åç§° | æ–°åç§° | è¯´æ˜ |
|--------|--------|------|
| `meituanRows` (any[]) | `meituanOrders` (MeituanOrder[]) | ç¾å›¢è®¢å•åˆ—è¡¨ |
| `handoverRows` | `inventoryItems` | ç›˜ç‚¹é¡¹ç›® |

---

## ğŸ› ï¸ å®æ–½æ­¥éª¤

### Step 1: æ·»åŠ ç±»å‹å®šä¹‰ (30åˆ†é’Ÿ)
```typescript
// src/api/types.ts
export interface MeituanOrder {
  id: number
  name: string
  nameMain: string
  type: string
  coupon: string
  amount: number
  discount: number
  actual: number
  financial: number
  barPrice: number
  time: string
  phone: string
  remark: string
  store: string
}

export interface ShiftCalculation {
  internetFee: number
  salesRevenue: number
  meituanRevenue: number
  expenditure: number
  income: number
  amountDue: number
}

export interface FinanceRecord {
  item: string
  amount: number
  barPay: number
  financePay: number
}
```

### Step 2: å®ç°åç«¯API (2å°æ—¶)
1. åˆ›å»ºAPIæ¨¡å—ç»“æ„
2. å®ç°ç¾å›¢è®¢å•API
3. å®ç°äº¤ç­è®¡ç®—API
4. å®ç°è´¢åŠ¡è®°è´¦API
5. æ›´æ–°http_server.rsè·¯ç”±

### Step 3: æ›´æ–°å‰ç«¯APIè°ƒç”¨ (1å°æ—¶)
1. åˆ›å»ºmeituan.ts APIæ–‡ä»¶
2. åˆ›å»ºshift.ts APIæ–‡ä»¶
3. åˆ›å»ºfinance.ts APIæ–‡ä»¶
4. æ›´æ–°CashierView.vueä½¿ç”¨æ–°API

### Step 4: é‡å‘½åå˜é‡ (1.5å°æ—¶)
1. æ›´æ–°ShiftStateæ¥å£
2. å…¨å±€æœç´¢æ›¿æ¢æ‹¼éŸ³å˜é‡
3. æ›´æ–°æ‰€æœ‰å¼•ç”¨
4. æµ‹è¯•åŠŸèƒ½å®Œæ•´æ€§

### Step 5: é‡æ„å¯¼èˆªæ  (1å°æ—¶)
1. åˆ†ç¦»mainNavigationå’ŒexternalTools
2. æ›´æ–°MainLayout.vue
3. æ·»åŠ å¤–éƒ¨å·¥å…·åŒºåŸŸUI
4. æµ‹è¯•å¯¼èˆªåŠŸèƒ½

### Step 6: æ‹†åˆ†å¤§æ–‡ä»¶ (2å°æ—¶)
1. æå–HandoverModuleç»„ä»¶
2. æå–FinanceModuleç»„ä»¶
3. æå–MeituanModuleç»„ä»¶
4. æ›´æ–°CashierView.vueå¯¼å…¥

### Step 7: æµ‹è¯•å’Œæ–‡æ¡£ (1å°æ—¶)
1. åŠŸèƒ½æµ‹è¯•
2. APIæ–‡æ¡£
3. æ›´æ–°README
4. æäº¤ä»£ç 

---

## âœ… æ£€æŸ¥æ¸…å•

### é˜¶æ®µä¸€å®Œæˆæ ‡å‡†
- [ ] æ‰€æœ‰APIç«¯ç‚¹æ­£å¸¸å·¥ä½œ
- [ ] æµè§ˆå™¨ç‰ˆæœ¬å¯ä»¥è®¿é—®å®Œæ•´æ•°æ®
- [ ] APIå“åº”æ ¼å¼ç»Ÿä¸€
- [ ] æœ‰åŸºæœ¬çš„é”™è¯¯å¤„ç†

### é˜¶æ®µäºŒå®Œæˆæ ‡å‡†
- [ ] æ— æ‹¼éŸ³å˜é‡å
- [ ] æ‰€æœ‰æ¥å£éƒ½æœ‰TypeScriptå®šä¹‰
- [ ] æ— anyç±»å‹ï¼ˆé™¤ç‰¹æ®Šæƒ…å†µï¼‰
- [ ] ä»£ç é€šè¿‡TypeScriptä¸¥æ ¼æ£€æŸ¥

### é˜¶æ®µä¸‰å®Œæˆæ ‡å‡†
- [ ] å¯¼èˆªæ æ¸…æ™°åŒºåˆ†å†…å¤–éƒ¨é“¾æ¥
- [ ] ç”¨æˆ·ä½“éªŒæµç•…
- [ ] å¤–éƒ¨é“¾æ¥æœ‰æ˜ç¡®æ ‡è¯†

### é˜¶æ®µå››å®Œæˆæ ‡å‡†
- [ ] CashierView.vueå°‘äº500è¡Œ
- [ ] ç»„ä»¶èŒè´£å•ä¸€
- [ ] ä»£ç å¯ç»´æŠ¤æ€§æå‡

---

## ğŸš¨ é£é™©å’Œæ³¨æ„äº‹é¡¹

### é£é™©ç‚¹
1. **æ•°æ®å…¼å®¹æ€§**: é‡å‘½åå˜é‡å¯èƒ½å½±å“å·²ä¿å­˜çš„è‰ç¨¿æ•°æ®
2. **APIå˜æ›´**: éœ€è¦åŒæ—¶æ›´æ–°å‰åç«¯
3. **æµ‹è¯•è¦†ç›–**: ç¡®ä¿æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

### ç¼“è§£æªæ–½
1. **æ•°æ®è¿ç§»**: æ·»åŠ æ•°æ®è¿ç§»é€»è¾‘ï¼Œå…¼å®¹æ—§å­—æ®µå
2. **æ¸è¿›å¼é‡æ„**: ä¿æŒå‘åå…¼å®¹ï¼Œé€æ­¥åºŸå¼ƒæ—§API
3. **å……åˆ†æµ‹è¯•**: æ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡Œå®Œæ•´æµ‹è¯•

---

## ğŸ“Š è¿›åº¦è·Ÿè¸ª

| é˜¶æ®µ | ä»»åŠ¡ | çŠ¶æ€ | å®Œæˆæ—¶é—´ |
|------|------|------|----------|
| å‡†å¤‡ | åˆ›å»ºåˆ†æ”¯å’Œå¤‡ä»½ | âœ… å®Œæˆ | 2026-01-17 21:02 |
| é˜¶æ®µä¸€ | APIå®Œå–„ | â³ è¿›è¡Œä¸­ | - |
| é˜¶æ®µäºŒ | å‘½åè§„èŒƒåŒ– | ğŸ“… å¾…å¼€å§‹ | - |
| é˜¶æ®µä¸‰ | å¯¼èˆªæ é‡æ„ | ğŸ“… å¾…å¼€å§‹ | - |
| é˜¶æ®µå›› | ä»£ç ä¼˜åŒ– | ğŸ“… å¾…å¼€å§‹ | - |

---

## ğŸ“ å­¦ä¹ è¦ç‚¹

### TypeScriptæœ€ä½³å®è·µ
- ä½¿ç”¨interfaceè€Œétypeï¼ˆé™¤ééœ€è¦è”åˆç±»å‹ï¼‰
- é¿å…anyï¼Œä½¿ç”¨unknownæˆ–å…·ä½“ç±»å‹
- åˆ©ç”¨æ³›å‹æé«˜ä»£ç å¤ç”¨æ€§

### APIè®¾è®¡åŸåˆ™
- RESTfulé£æ ¼
- ç»Ÿä¸€å“åº”æ ¼å¼
- é€‚å½“çš„é”™è¯¯å¤„ç†
- ç‰ˆæœ¬æ§åˆ¶

### ç»„ä»¶è®¾è®¡åŸåˆ™
- å•ä¸€èŒè´£
- é«˜å†…èšä½è€¦åˆ
- Propså‘ä¸‹ï¼ŒEventså‘ä¸Š
- åˆç†ä½¿ç”¨ç»„åˆå¼API

---

## ğŸ“ æäº¤è§„èŒƒ

ä½¿ç”¨çº¦å®šå¼æäº¤ï¼ˆConventional Commitsï¼‰ï¼š

```
feat: æ·»åŠ ç¾å›¢è®¢å•API
fix: ä¿®å¤äº¤ç­è®¡ç®—é”™è¯¯
refactor: é‡å‘½åShiftStateå˜é‡ä¸ºè‹±æ–‡
docs: æ›´æ–°APIæ–‡æ¡£
test: æ·»åŠ å•å…ƒæµ‹è¯•
chore: æ›´æ–°ä¾èµ–
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [CODE_REVIEW_REPORT.md](./CODE_REVIEW_REPORT.md) - ä»£ç å®¡æŸ¥æŠ¥å‘Š
- [KNOWLEDGE_BASE.md](./KNOWLEDGE_BASE.md) - é¡¹ç›®çŸ¥è¯†åº“
- [CHANGELOG.md](./CHANGELOG.md) - å˜æ›´æ—¥å¿—

---

**æœ€åæ›´æ–°**: 2026-01-17 21:02  
**è´Ÿè´£äºº**: AI Code Refactoring Assistant  
**å®¡æ ¸äºº**: å¾…å®š
